<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scan Info</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-4">

  <!-- Overlay loading -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="text-white text-xl">កំពុងផ្ទុក...</div>
  </div>

  <!-- Main Container -->
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md text-center" id="customerInfoBox">
    <h1 class="text-xl font-bold mb-4">ព័ត៌មានអតិថិជន</h1>
    <div id="customerContent" class="space-y-2">
      <p class="text-sm text-gray-600">កំពុងទាញទិន្នន័យ...</p>
    </div>
  </div>

  <script>
    // ✅ Firebase Config (REPLACE with your own Firebase project config)
    const firebaseConfig = {
      apiKey: "AIzaSyD61vUNw4gFmzR4zfS8s7FVIzsJe9nXQHQ",
  authDomain: "home-invoice-e1f43.firebaseapp.com",
  databaseURL: "https://home-invoice-e1f43-default-rtdb.firebaseio.com",
  projectId: "home-invoice-e1f43",
  storageBucket: "home-invoice-e1f43.appspot.com",  // <-- ចំណាំទីនេះ
  messagingSenderId: "243294137874",
  appId: "1:243294137874:web:8bdc0aab16ca58f4d932cb",
    };

    // ✅ Init Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ✅ Show loading overlay
    function showLoading(show = true) {
      document.getElementById("loadingOverlay").style.display = show ? "flex" : "none";
    }

    // ✅ Get ID from URL param
    function getCustomerIDFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("id") || null;
    }

    // ✅ Show customer data in UI
    function renderCustomer(data) {
      const content = document.getElementById("customerContent");
      content.innerHTML = `
        <p><strong>ឈ្មោះ:</strong> ${data.name || "N/A"}</p>
        <p><strong>លេខបន្ទប់:</strong> ${data.room || "N/A"}</p>
        <p><strong>ទូរស័ព្ទ:</strong> ${data.phone || "N/A"}</p>
        ${data.phone2 ? `<p><strong>ទូរស័ព្ទ 2:</strong> ${data.phone2}</p>` : ""}
        <p class="text-sm text-gray-400">ID: ${data.id}</p>
      `;
    }

    // ✅ Load from Firebase
    async function loadCustomerInfo(customerID) {
      if (!customerID) {
        document.getElementById("customerContent").innerHTML = `<p class="text-red-500">❌ មិនមាន ID</p>`;
        return;
      }

      showLoading(true);
      try {
        const doc = await db.collection("customers").doc(customerID).get();
        if (doc.exists) {
          renderCustomer({ id: customerID, ...doc.data() });
        } else {
          document.getElementById("customerContent").innerHTML = `<p class="text-red-500">❌ មិនមានអតិថិជននេះទេ</p>`;
        }
      } catch (error) {
        console.error("Error loading:", error);
        document.getElementById("customerContent").innerHTML = `<p class="text-red-500">❌ បរាជ័យក្នុងការទាញទិន្នន័យ</p>`;
      } finally {
        showLoading(false);
      }
    }

    // ✅ Run on page load
    window.addEventListener("DOMContentLoaded", () => {
      const id = getCustomerIDFromURL();
      loadCustomerInfo(id);
    });
  </script>
</body>
</html>
